# talos configuration

Per-cluster talos configuration and patches.

## Structure

```
<cluster>
├── Makefile # tooling to generate & apply configuration
├── _out     # generated configuration. DO NOT COMMIT.
│
├── patches
│   ├── *.yaml              # global patches
│   ├── controlplane/*.yaml # control plane patches
│   └── worker/*.yaml       # worker patches
│
└── hosts
    ├── hosts.yaml          # basic host & interface mappings
    ├── generate.sh         # reads hosts.yaml to generate patches
    ├── Makefile            # calls generate.sh
    ├── controlplane
    │   ├── <host>.yaml     # generated by generate.sh
    │   └── <host>/*.yaml   # other per-host patches
    └── worker
        ├── <host>.yaml
        └── <host>/*.yaml

```

## Usage

```console
# Generate configuration
$ make clean all

# initial installation
$ make ROLE=controlplane CONFIG=control-1 NODE=10.89.0.123 apply-insecure
$ make ROLE=worker CONFIG=worker-1 NODE=10.89.0.124 apply-insecure

# update configuration
$ make ROLE=controlplane CONFIG=control-1 NODE=10.89.0.123 apply
$ make ROLE=worker CONFIG=worker-1 NODE=10.89.0.124 apply
```
