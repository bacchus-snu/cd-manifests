# Enable resource pinning for CPU, memory, and NUMA affinity
# Requires Guaranteed QoS pods (requests = limits) to take effect
# ref: https://kubernetes.io/docs/concepts/policy/node-resource-managers/
machine:
  kubelet:
    extraConfig:
      # CPU Manager - allocates exclusive CPUs to Guaranteed pods
      cpuManagerPolicy: "static"
      cpuManagerReconcilePeriod: "10s"

      # Topology Manager - coordinates resource placement for NUMA affinity
      topologyManagerPolicy: "best-effort"
      topologyManagerScope: "container"

      # Memory Manager - allocates memory with NUMA affinity for Guaranteed pods
      memoryManagerPolicy: "Static"

      # Reserve resources for Kubernetes system daemons
      kubeReserved:
        cpu: "1000m"
        memory: "2Gi"
        ephemeral-storage: "1Gi"

      # Reserve resources for OS system daemons
      systemReserved:
        cpu: "500m"
        memory: "1Gi"
        ephemeral-storage: "1Gi"

      # Enforce reserved resource limits via cgroups (pods only initially)
      enforceNodeAllocatable:
        - "pods"
